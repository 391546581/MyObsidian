
# 构建镜像
## podman build -t my-flutter-build:3.19.6 .
## 编译
## podman run --rm -v D:\retail_cashier:/workspace -w /workspace my-flutter-build:3.19.6 flutter build apk --no-tree-shake-icons --release
## podman run --rm -v D:\retail_cashier:/home/flutter my-flutter-build:3.19.6 flutter build apk --no-tree-shake-icons --release
## 如果遇到权限问题（Permission Denied），可能需要给 podman run 加上 --userns=keep-id 参数（如果不报错就不用加）。



解决方案
为了解决崩溃并加速构建，你必须持久化挂载构建缓存，这样 NDK 只需要下载一次，下次直接用现成的，速度快且稳定。

请使用以下优化后的命令（注意新增的两个 -v 挂载参数）：

powershell
# 1. 先重启一下可能已经卡死的 Podman (现在的状态看起来有点异常)
podman machine stop
podman machine start
# 2. 运行带缓存的构建命令
# -v android_sdk:/opt/android-sdk : 缓存 SDK/NDK，避免重复下载
# -v gradle_cache:/home/flutter/.gradle : 缓存 Gradle 依赖
podman run --rm `
  -v D:\retail_cashier:/workspace `
  -v android_sdk:/opt/android-sdk `
  -v gradle_cache:/home/flutter/.gradle `
  -w /workspace `
  my-flutter-build:3.19.6 `
  flutter build apk --no-tree-shake-icons --release
第一次运行依然会下载 NDK，如果还是崩，请尝试在执行 run 命令前暂时调大 .wslconfig 里的内存设置（比如 12GB），等缓存下载好了再改回来。